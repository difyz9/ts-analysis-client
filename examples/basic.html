<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analytics Client - åŸºç¡€ç¤ºä¾‹</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      line-height: 1.6;
    }
    h1 { color: #333; }
    .button-group {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin: 20px 0;
    }
    button {
      padding: 10px 20px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }
    button:hover {
      background: #45a049;
    }
    button:active {
      transform: scale(0.98);
    }
    .info-box {
      background: #f4f4f4;
      padding: 15px;
      border-radius: 4px;
      margin: 20px 0;
    }
    .info-box pre {
      margin: 0;
      overflow-x: auto;
    }
    .log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      max-height: 400px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      margin-top: 20px;
    }
    .log-item {
      margin: 5px 0;
      padding: 3px 0;
      border-bottom: 1px solid #333;
    }
    .log-time {
      color: #6a9955;
    }
    .log-success {
      color: #4ec9b0;
    }
    .log-error {
      color: #f48771;
    }
  </style>
</head>
<body>
  <h1>ğŸš€ Analytics Client - åŸºç¡€ç¤ºä¾‹</h1>
  
  <div class="info-box">
    <h3>é…ç½®ä¿¡æ¯</h3>
    <pre id="config-info">åŠ è½½ä¸­...</pre>
  </div>

  <h3>å¿«é€Ÿæµ‹è¯•</h3>
  <div class="button-group">
    <button onclick="trackSimpleEvent()">ğŸ“Š è¿½è¸ªç®€å•äº‹ä»¶</button>
    <button onclick="trackPageView()">ğŸ“„ è¿½è¸ªé¡µé¢æµè§ˆ</button>
    <button onclick="trackUserAction()">ğŸ‘† è¿½è¸ªç”¨æˆ·æ“ä½œ</button>
    <button onclick="reportInstall()">ğŸ“¦ ä¸ŠæŠ¥å®‰è£…</button>
    <button onclick="verifyLicense()">ğŸ” éªŒè¯ License</button>
    <button onclick="getLicense()">â„¹ï¸ è·å– License</button>
    <button onclick="getStats()">ğŸ“ˆ è·å–ç»Ÿè®¡</button>
    <button onclick="flushEvents()">ğŸ’¾ åˆ·æ–°äº‹ä»¶é˜Ÿåˆ—</button>
  </div>

  <h3>æ§åˆ¶å°æ—¥å¿—</h3>
  <div class="log" id="log"></div>

  <!-- å¼•å…¥æ‰“åŒ…åçš„ SDK -->
  <script src="../dist/index.umd.js"></script>
  
  <script>
    // ä» UMD åŒ…ä¸­è·å–
    const { Analytics } = window.AnalyticsClient;
    
    // é…ç½®ï¼ˆè¯·ä¿®æ”¹ä¸ºæ‚¨çš„æœåŠ¡å™¨åœ°å€ï¼‰
    const config = {
      serverUrl: 'http://localhost:8080',
      productName: 'TestApp',
      debug: true,
      batchSize: 3,
      flushInterval: 10000, // 10ç§’è‡ªåŠ¨åˆ·æ–°
    };

    // åˆå§‹åŒ–
    Analytics.initialize(config);
    const client = Analytics.getInstance();

    // æ˜¾ç¤ºé…ç½®ä¿¡æ¯
    document.getElementById('config-info').textContent = JSON.stringify({
      serverUrl: config.serverUrl,
      productName: config.productName,
      deviceId: client.getDeviceId(),
      queueSize: client.getQueueSize(),
    }, null, 2);

    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const time = new Date().toLocaleTimeString();
      const className = type === 'error' ? 'log-error' : type === 'success' ? 'log-success' : '';
      
      const item = document.createElement('div');
      item.className = 'log-item';
      item.innerHTML = `<span class="log-time">[${time}]</span> <span class="${className}">${message}</span>`;
      
      logDiv.insertBefore(item, logDiv.firstChild);
      
      // æ›´æ–°é˜Ÿåˆ—å¤§å°
      updateQueueSize();
    }

    function updateQueueSize() {
      const configEl = document.getElementById('config-info');
      const currentConfig = JSON.parse(configEl.textContent);
      currentConfig.queueSize = client.getQueueSize();
      configEl.textContent = JSON.stringify(currentConfig, null, 2);
    }

    // è¿½è¸ªç®€å•äº‹ä»¶
    async function trackSimpleEvent() {
      try {
        await Analytics.track('button_click', {
          button_name: 'test_button',
          timestamp: Date.now(),
          screen: 'demo',
        });
        log('âœ“ ç®€å•äº‹ä»¶å·²è¿½è¸ª', 'success');
      } catch (error) {
        log(`âœ— è¿½è¸ªå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // è¿½è¸ªé¡µé¢æµè§ˆ
    async function trackPageView() {
      try {
        await Analytics.trackPageView(
          window.location.pathname,
          document.title,
          { referrer: document.referrer || 'direct' }
        );
        log('âœ“ é¡µé¢æµè§ˆå·²è¿½è¸ª', 'success');
      } catch (error) {
        log(`âœ— è¿½è¸ªå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // è¿½è¸ªç”¨æˆ·æ“ä½œ
    async function trackUserAction() {
      try {
        await Analytics.trackAction(
          'user',
          'click',
          'demo_button',
          1.0,
          { source: 'demo_page' }
        );
        log('âœ“ ç”¨æˆ·æ“ä½œå·²è¿½è¸ª', 'success');
      } catch (error) {
        log(`âœ— è¿½è¸ªå¤±è´¥: ${error.message}`, 'error');
      }
    }

    // ä¸ŠæŠ¥å®‰è£…
    async function reportInstall() {
      try {
        const response = await Analytics.reportInstall({
          app_version: '1.0.0',
        });
        
        if (response.code === 200) {
          log('âœ“ å®‰è£…äº‹ä»¶å·²ä¸ŠæŠ¥', 'success');
        } else {
          log(`âœ— ä¸ŠæŠ¥å¤±è´¥: ${response.message}`, 'error');
        }
      } catch (error) {
        log(`âœ— ä¸ŠæŠ¥å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // éªŒè¯ License
    async function verifyLicense() {
      try {
        const status = await Analytics.verifyLicense();
        if (status) {
          log(`âœ“ License éªŒè¯æˆåŠŸ: ${JSON.stringify(status)}`, 'success');
        } else {
          log('âœ— License éªŒè¯å¤±è´¥', 'error');
        }
      } catch (error) {
        log(`âœ— éªŒè¯å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // è·å– License
    async function getLicense() {
      try {
        const status = await client.getLicense();
        if (status) {
          log(`âœ“ License ä¿¡æ¯: ${JSON.stringify(status)}`, 'success');
        } else {
          log('âœ— è·å– License å¤±è´¥', 'error');
        }
      } catch (error) {
        log(`âœ— è·å–å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // è·å–ç»Ÿè®¡
    async function getStats() {
      try {
        const response = await client.getStats();
        if (response.code === 200) {
          log(`âœ“ ç»Ÿè®¡ä¿¡æ¯: ${JSON.stringify(response.data)}`, 'success');
        } else {
          log(`âœ— è·å–å¤±è´¥: ${response.message}`, 'error');
        }
      } catch (error) {
        log(`âœ— è·å–å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // åˆ·æ–°äº‹ä»¶é˜Ÿåˆ—
    async function flushEvents() {
      try {
        const success = await Analytics.flush();
        if (success) {
          log('âœ“ äº‹ä»¶é˜Ÿåˆ—å·²åˆ·æ–°', 'success');
        } else {
          log('âœ— åˆ·æ–°å¤±è´¥', 'error');
        }
      } catch (error) {
        log(`âœ— åˆ·æ–°å¤±è´¥: ${error.message}`, 'error');
      }
    }

    // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿½è¸ª
    window.addEventListener('load', () => {
      log('ğŸ“± é¡µé¢åŠ è½½å®Œæˆï¼ŒSDK å·²å°±ç»ª');
      trackPageView();
    });

    // é¡µé¢å¸è½½æ—¶è‡ªåŠ¨åˆ·æ–°
    window.addEventListener('beforeunload', () => {
      log('ğŸ‘‹ é¡µé¢å³å°†å¸è½½ï¼Œåˆ·æ–°äº‹ä»¶é˜Ÿåˆ—...');
    });
  </script>
</body>
</html>
